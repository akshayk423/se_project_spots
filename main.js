!function(){"use strict";var e="";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit",inactiveButtonClass:"modal__submit_type_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},r=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),o.textContent="",o.classList.add(r.errorClass)},o=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):s(t,r)},n=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},s=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1};var a=e+"d3610e9c6dce3cb370d8.svg",i=e+"1ecf96fab54a91c898b4.svg",c=e+"40608da7369d39bc1077.svg";const d=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}addCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{headers:this._headers,method:"DELETE",body:JSON.stringify({cardId:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{headers:this._headers,method:"PUT",body:JSON.stringify({cardId:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}dislikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{headers:this._headers,method:"DELETE",body:JSON.stringify({cardId:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}spotsStartUp(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"6e58b2db-8c6b-4765-b44f-89c77c553815","Content-Type":"application/json"}}),l=document.querySelector(".profile__name"),u=document.querySelector(".profile__description"),m=document.querySelector(".profile__avatar");document.getElementById("spots-logo").src=a,document.getElementById("edit-icon").src=i,document.getElementById("plus-icon").src=c;const _=document.querySelector(".profile__edit-profile-btn"),h=document.querySelector("#edit-profile-modal"),y=document.forms.profile,v=document.querySelector(".profile__new-post-btn"),b=document.querySelector("#new-post-modal"),f=document.forms.newPost,S=document.querySelector("#delete-card-modal"),p=document.querySelector(".modal__delete-btn"),E=document.querySelector(".modal__cancel-btn"),k=document.querySelector(".profile__avatar-edit-btn"),q=document.querySelector("#edit-avatar-modal"),C=document.forms.avatar,g=document.querySelector("#avatar-link-input"),L=document.querySelector(".profile__column"),$=L.querySelector(".profile__name"),x=L.querySelector(".profile__description"),U=h.querySelector("#profile-name-input"),j=h.querySelector("#describe-input"),P=b.querySelector("#image-link-input"),A=b.querySelector("#caption-input"),I=document.querySelector(".cards__list"),B=document.querySelector("#modal-image"),w=B.querySelector(".modal__image"),D=B.querySelector(".modal__caption"),N=document.querySelector("#card-template").content;let O,T;function J(e){"Escape"===e.key&&z(document.querySelector(".modal_is-opened"))}function H(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",J)}function z(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",J)}function M(e,t="prepend"){const r=function(e){const t=N.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__text"),o=t.querySelector(".card__image");o.setAttribute("src",e.link),o.setAttribute("alt",e.name),r.textContent=e.name;const n=t.querySelector(".card__like-btn");return e.isLiked&&n.classList.toggle("card__like-btn_liked"),n.addEventListener("click",t=>{var r,o;r=t.target,o=e._id,e.isLiked?d.dislikeCard(o).then(()=>r.classList.toggle("card__like-btn_liked")).catch(e=>console.error(e)):d.likeCard(o).then(()=>r.classList.toggle("card__like-btn_liked")).catch(e=>console.error(e))}),t.querySelector(".card__delete-btn").addEventListener("click",r=>{!function(e,t){O=e,T=t,H(S)}(t,e._id)}),o.addEventListener("click",()=>{w.setAttribute("src",e.link),w.setAttribute("alt",e.name),D.textContent=e.name,H(B)}),t}(e);I[t](r)}var F;document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("mousedown",t=>{(t.target===e||t.target.classList.contains("modal__close-btn"))&&z(e)})}),k.addEventListener("click",()=>{H(q)}),_.addEventListener("click",function(){H(h),U.value=$.textContent,j.value=x.textContent,((e,t,n)=>{t.forEach(t=>{r(e,t,n)});const s=e.querySelector(n.submitButtonSelector);o(t,s,n)})(y,[U,j],t)}),v.addEventListener("click",function(){H(b)}),y.addEventListener("submit",e=>{e.preventDefault();const t=U.value,r=j.value,o=y.querySelector(".modal__submit");o.textContent="Saving...",o.disabled=!0,d.editUserInfo({name:t,about:r}).then(e=>{l.textContent=e.name,u.textContent=e.about}).catch(e=>console.error(e)).finally(()=>{z(h),U.value=l.textContent,j.value=u.textContent,o.textContent="Save",o.disabled=!1})}),E.addEventListener("click",()=>{z(S)}),f.addEventListener("submit",e=>{e.preventDefault();const r=A.value,o=P.value,s=f.querySelector(".modal__submit");s.textContent="Saving...",s.disabled=!0,d.addCard({name:r,link:o}).then(e=>{M(e)}).catch(e=>console.error(e)).finally(()=>{s.textContent="Save",s.disabled=!1,f.reset(),n(s,t),z(b)})}),p.addEventListener("click",function(){p.textContent="Deleting...",d.deleteCard(T).then(()=>{O.remove()}).catch(e=>console.error(e)).finally(()=>z(S))}),C.addEventListener("submit",e=>{e.preventDefault();const r=g.value,o=C.querySelector(".modal__submit");o.textContent="Saving...",o.disabled=!0,d.editUserAvatar(r).then(e=>m.src=e.avatar).catch(e=>console.error(e)).finally(()=>{o.textContent="Save",o.disabled=!1,z(q),C.reset(),n(o,t)})}),F=t,Array.from(document.querySelectorAll(F.formSelector)).forEach(e=>{e.addEventListener("submit",function(e){e.preventDefault()}),((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);o(n,s,t),n.forEach(a=>{a.addEventListener("input",function(){((e,t,o)=>{t.validity.valid?r(e,t,o):((e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)})(e,t,t.validationMessage,o)})(e,a,t),o(n,s,t)})})})(e,F)}),d.spotsStartUp().then(e=>{const[t,r]=e;l.textContent=r.name,u.textContent=r.about,m.src=r.avatar,t.forEach(e=>M(e))}).catch(e=>{console.error(e)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YUUsS0FDdEMsTUFBTVMsRUFBWTJILE1BQU1DLEtBQ3RCdkksRUFBWTRILGlCQUFpQjFILEVBQU9SLGdCQUVoQ2tCLEVBQWdCWixFQUFZSSxjQUFjRixFQUFPUCxzQkFDdkRlLEVBQWtCQyxFQUFXQyxFQUFlVixHQUM1Q1MsRUFBVWtILFFBQVM1SCxJQUNqQkEsRUFBYXFHLGlCQUFpQixRQUFTLFdBcERoQm1DLEVBQUN6SSxFQUFhQyxFQUFjQyxLQUNoREQsRUFBYWEsU0FBU0MsTUFRekJoQixFQUFlQyxFQUFhQyxFQUFjQyxHQXZCdkJ3SSxFQUFDMUksRUFBYUMsRUFBYzBJLEVBQWN6SSxLQUMvRCxNQUFNQyxFQUFlSCxFQUFZSSxjQUFjLElBQUlILEVBQWFJLFlBQ2hFSixFQUFhSyxVQUFVRyxJQUFJUCxFQUFPTCxpQkFDbENNLEVBQWFLLFlBQWNtSSxFQUMzQnhJLEVBQWFHLFVBQVVHLElBQUlQLEVBQU9KLGFBWWhDNEksQ0FDRTFJLEVBQ0FDLEVBQ0FBLEVBQWEySSxrQkFDYjFJLElBK0NBdUksQ0FBbUJ6SSxFQUFhQyxFQUFjQyxHQUM5Q1EsRUFBa0JDLEVBQVdDLEVBQWVWLEVBQzlDLE1BVUFzSSxDQUFrQnhJLEVBQWFFLEtDeUxqQ2tCLEVBQ0dpQyxlQUNBdkIsS0FBTStHLElBQ0wsTUFBT0MsRUFBV0MsR0FBWUYsRUFROUJyRixFQUFnQmhELFlBQWN1SSxFQUFTeEcsS0FDdkNtQixFQUFpQmxELFlBQWN1SSxFQUFTdkcsTUFDeENtQixFQUFrQkUsSUFBTWtGLEVBQVNqRyxPQUdqQ2dHLEVBQVVqQixRQUFTbUIsR0FBU3hDLEVBQVd3QyxNQUV4QzFCLE1BQU9DLElBQ05DLFFBQVFDLE1BQU1GLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9JbnNlcnQgcHJvamVjdCBuYW1lL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0luc2VydCBwcm9qZWN0IG5hbWUvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vSW5zZXJ0IHByb2plY3QgbmFtZS8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRlLmpzIiwid2VicGFjazovL0luc2VydCBwcm9qZWN0IG5hbWUvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vSW5zZXJ0IHByb2plY3QgbmFtZS8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIl9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7IiwiZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0XCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0X3R5cGVfZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXHJcbn07XHJcblxyXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQ2xhc3MpO1xyXG59O1xyXG5cclxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQ2xhc3MpO1xyXG59O1xyXG5cclxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICBzaG93SW5wdXRFcnJvcihcclxuICAgICAgZm9ybUVsZW1lbnQsXHJcbiAgICAgIGlucHV0RWxlbWVudCxcclxuICAgICAgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLFxyXG4gICAgICBjb25maWdcclxuICAgICk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICB9KTtcclxufTtcclxuXHJcbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XHJcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGVuYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBjb25maWcpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbn07XHJcblxyXG5jb25zdCBlbmFibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjb25maWcpO1xyXG4gIH0pO1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xyXG59O1xyXG5cclxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxyXG4gICk7XHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xyXG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xyXG4gICAgZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgY29uZmlnKTtcclxuICB9KTtcclxufTtcclxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IHtcclxuICByZXNldFZhbGlkYXRpb24sXHJcbiAgZW5hYmxlVmFsaWRhdGlvbixcclxuICBkaXNhYmxlQnV0dG9uLFxyXG4gIHZhbGlkYXRpb25Db25maWcsXHJcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGUuanNcIjtcclxuXHJcbmltcG9ydCBsb2dvU3JjIGZyb20gXCIuLi9pbWFnZXMvaWNvbnMvbG9nby5zdmdcIjtcclxuaW1wb3J0IGVkaXRJY29uU3JjIGZyb20gXCIuLi9pbWFnZXMvaWNvbnMvZWRpdC1pY29uLnN2Z1wiO1xyXG5pbXBvcnQgcGx1c0ljb25TcmMgZnJvbSBcIi4uL2ltYWdlcy9pY29ucy9wbHVzLnN2Z1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcIjZlNThiMmRiLThjNmItNDc2NS1iNDRmLTg5Yzc3YzU1MzgxNVwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcblxyXG5jb25zdCB1c2VyUHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XHJcbmNvbnN0IHVzZXJQcm9maWxlQWJvdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xyXG5jb25zdCB1c2VyUHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG5cclxuLy9pbWFnZSBpbXBvcnRzXHJcbmNvbnN0IHNwb3RzTG9nbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3BvdHMtbG9nb1wiKTtcclxuc3BvdHNMb2dvLnNyYyA9IGxvZ29TcmM7XHJcblxyXG5jb25zdCBlZGl0SWNvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZWRpdC1pY29uXCIpO1xyXG5lZGl0SWNvbi5zcmMgPSBlZGl0SWNvblNyYztcclxuXHJcbmNvbnN0IHBsdXNJY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbHVzLWljb25cIik7XHJcbnBsdXNJY29uLnNyYyA9IHBsdXNJY29uU3JjO1xyXG5cclxuY29uc3QgZWRpdFByb2ZpbGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtcHJvZmlsZS1idG5cIik7XHJcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcclxuLy8gY29uc3QgZWRpdFByb2ZpbGVDbG9zZUJ0biA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBlZGl0UHJvZmlsZUZvcm0gPSBkb2N1bWVudC5mb3Jtcy5wcm9maWxlO1xyXG5cclxuY29uc3QgbmV3UG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmV3LXBvc3QtYnRuXCIpO1xyXG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xyXG4vLyBjb25zdCBuZXdQb3N0Q2xvc2VCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBuZXdQb3N0Rm9ybSA9IGRvY3VtZW50LmZvcm1zLm5ld1Bvc3Q7XHJcblxyXG5jb25zdCBkZWxldGVDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1jYXJkLW1vZGFsXCIpO1xyXG5jb25zdCBkZWxldGVDYXJkQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZGVsZXRlLWJ0blwiKTtcclxuY29uc3QgY2FuY2VsRGVsZXRlQ2FyZEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhbmNlbC1idG5cIik7XHJcblxyXG5jb25zdCBlZGl0QXZhdGFyQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItZWRpdC1idG5cIik7XHJcbmNvbnN0IGVkaXRBdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XHJcbmNvbnN0IGVkaXRBdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXMuYXZhdGFyO1xyXG5jb25zdCBhdmF0YXJMaW5rSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1saW5rLWlucHV0XCIpO1xyXG5cclxuLy8gZ2V0IHByb2ZpbGUgbmFtZSBhbmQgZGVzY3JpcHRpb25cclxuY29uc3QgcHJvZmlsZUluZm9ybWF0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19jb2x1bW5cIik7XHJcbmNvbnN0IHByb2ZpbGVOYW1lID0gcHJvZmlsZUluZm9ybWF0aW9uLnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gcHJvZmlsZUluZm9ybWF0aW9uLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIlxyXG4pO1xyXG5cclxuLy8gZ2V0IGlucHV0IGVsZW1lbnRzIGZyb20gdGhlIG1vZGFsc1xyXG5jb25zdCBwcm9maWxlTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcclxuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPVxyXG4gIGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNkZXNjcmliZS1pbnB1dFwiKTtcclxuXHJcbmNvbnN0IGltYWdlTGlua0lucHV0ID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2UtbGluay1pbnB1dFwiKTtcclxuY29uc3QgY2FwdGlvbklucHV0ID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FwdGlvbi1pbnB1dFwiKTtcclxuXHJcbmNvbnN0IGNhcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xyXG5cclxuLy9tb2RhbCBwcmV2aWV3IGVsZW1lbnRzXHJcbmNvbnN0IG1vZGFsSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsLWltYWdlXCIpO1xyXG5jb25zdCBtb2RhbEltYWdlUHJldmlldyA9IG1vZGFsSW1hZ2UucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XHJcbmNvbnN0IGNhcHRpb24gPSBtb2RhbEltYWdlLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XHJcblxyXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIikuY29udGVudDtcclxuXHJcbmNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XHJcblxyXG5sZXQgc2VsZWN0ZWRDYXJkO1xyXG5sZXQgc2VsZWN0ZWRDYXJkSWQ7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFc2NhcGUoZXZ0KSB7XHJcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgIGNvbnN0IG9wZW5Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfaXMtb3BlbmVkXCIpO1xyXG4gICAgY2xvc2VNb2RhbChvcGVuTW9kYWwpO1xyXG4gIH1cclxufVxyXG5cclxubW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XHJcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XHJcbiAgICBpZiAoXHJcbiAgICAgIGV2dC50YXJnZXQgPT09IG1vZGFsIHx8XHJcbiAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlLWJ0blwiKVxyXG4gICAgKSB7XHJcbiAgICAgIGNsb3NlTW9kYWwobW9kYWwpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIikuY2xvbmVOb2RlKHRydWUpO1xyXG4gIGNvbnN0IGNhcmRUaXRsZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGV4dFwiKTtcclxuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG5cclxuICBjYXJkSW1hZ2Uuc2V0QXR0cmlidXRlKFwic3JjXCIsIGRhdGEubGluayk7XHJcbiAgY2FyZEltYWdlLnNldEF0dHJpYnV0ZShcImFsdFwiLCBkYXRhLm5hbWUpO1xyXG4gIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuXHJcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xyXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcclxuICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuICB9XHJcbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcclxuICAgIGhhbmRsZUxpa2VDYXJkKGV2dC50YXJnZXQsIGRhdGEuX2lkLCBkYXRhLmlzTGlrZWQpO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBjYXJkRGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xyXG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcclxuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEuX2lkKTtcclxuICB9KTtcclxuXHJcbiAgY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBtb2RhbEltYWdlUHJldmlldy5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgZGF0YS5saW5rKTtcclxuICAgIG1vZGFsSW1hZ2VQcmV2aWV3LnNldEF0dHJpYnV0ZShcImFsdFwiLCBkYXRhLm5hbWUpO1xyXG4gICAgY2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICAgIG9wZW5Nb2RhbChtb2RhbEltYWdlKTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG59XHJcblxyXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcclxuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcclxuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xyXG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XHJcbn1cclxuXHJcbmVkaXRBdmF0YXJCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBvcGVuTW9kYWwoZWRpdEF2YXRhck1vZGFsKTtcclxufSk7XHJcblxyXG5lZGl0UHJvZmlsZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcclxuICBwcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XHJcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XHJcbiAgcmVzZXRWYWxpZGF0aW9uKFxyXG4gICAgZWRpdFByb2ZpbGVGb3JtLFxyXG4gICAgW3Byb2ZpbGVOYW1lSW5wdXQsIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0XSxcclxuICAgIHZhbGlkYXRpb25Db25maWdcclxuICApO1xyXG59KTtcclxuXHJcbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKTtcclxufSk7XHJcblxyXG5lZGl0UHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3QgbmFtZSA9IHByb2ZpbGVOYW1lSW5wdXQudmFsdWU7XHJcbiAgY29uc3QgYWJvdXQgPSBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZTtcclxuICBjb25zdCBzdWJtaXQgPSBlZGl0UHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0XCIpO1xyXG4gIHN1Ym1pdC50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgc3VibWl0LmRpc2FibGVkID0gdHJ1ZTtcclxuICBhcGlcclxuICAgIC5lZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICB1c2VyUHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSByZXMubmFtZTtcclxuICAgICAgdXNlclByb2ZpbGVBYm91dC50ZXh0Q29udGVudCA9IHJlcy5hYm91dDtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xyXG4gICAgICBwcm9maWxlTmFtZUlucHV0LnZhbHVlID0gdXNlclByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xyXG4gICAgICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHVzZXJQcm9maWxlQWJvdXQudGV4dENvbnRlbnQ7XHJcbiAgICAgIHN1Ym1pdC50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xyXG4gICAgICBzdWJtaXQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbmNhbmNlbERlbGV0ZUNhcmRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKGRlbGV0ZUNhcmRNb2RhbCk7XHJcbn0pO1xyXG5cclxubmV3UG9zdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3QgbmFtZSA9IGNhcHRpb25JbnB1dC52YWx1ZTtcclxuICBjb25zdCBsaW5rID0gaW1hZ2VMaW5rSW5wdXQudmFsdWU7XHJcbiAgY29uc3Qgc3VibWl0ID0gbmV3UG9zdEZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0XCIpO1xyXG4gIHN1Ym1pdC50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgc3VibWl0LmRpc2FibGVkID0gdHJ1ZTtcclxuICBhcGlcclxuICAgIC5hZGRDYXJkKHsgbmFtZSwgbGluayB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICByZW5kZXJDYXJkKHJlcyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgc3VibWl0LnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgICAgIHN1Ym1pdC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICBuZXdQb3N0Rm9ybS5yZXNldCgpO1xyXG4gICAgICBkaXNhYmxlQnV0dG9uKHN1Ym1pdCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICAgIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbmRlbGV0ZUNhcmRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XHJcblxyXG5lZGl0QXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBsaW5rID0gYXZhdGFyTGlua0lucHV0LnZhbHVlO1xyXG4gIGNvbnN0IHN1Ym1pdCA9IGVkaXRBdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdFwiKTtcclxuICBzdWJtaXQudGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG4gIHN1Ym1pdC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgYXBpXHJcbiAgICAuZWRpdFVzZXJBdmF0YXIobGluaylcclxuICAgIC50aGVuKChyZXMpID0+ICh1c2VyUHJvZmlsZUF2YXRhci5zcmMgPSByZXMuYXZhdGFyKSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHN1Ym1pdC50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xyXG4gICAgICBzdWJtaXQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgY2xvc2VNb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xyXG4gICAgICBlZGl0QXZhdGFyRm9ybS5yZXNldCgpO1xyXG4gICAgICBkaXNhYmxlQnV0dG9uKHN1Ym1pdCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4vLyBUaGUgZnVuY3Rpb24gYWNjZXB0cyBhIGNhcmQgb2JqZWN0IGFuZCBhIG1ldGhvZCBvZiBhZGRpbmcgdG8gdGhlIHNlY3Rpb25cclxuLy8gVGhlIG1ldGhvZCBpcyBpbml0aWFsbHkgYHByZXBlbmRgLCBidXQgeW91IGNhbiBwYXNzIGBhcHBlbmRgXHJcbmZ1bmN0aW9uIHJlbmRlckNhcmQoaXRlbSwgbWV0aG9kID0gXCJwcmVwZW5kXCIpIHtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGl0ZW0pO1xyXG4gIC8vIEFkZCB0aGUgY2FyZCBpbnRvIHRoZSBzZWN0aW9uIHVzaW5nIHRoZSBtZXRob2RcclxuICBjYXJkQ29udGFpbmVyW21ldGhvZF0oY2FyZEVsZW1lbnQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBjYXJkSWQpIHtcclxuICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcclxuICBzZWxlY3RlZENhcmRJZCA9IGNhcmRJZDtcclxuICBvcGVuTW9kYWwoZGVsZXRlQ2FyZE1vZGFsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlTGlrZUNhcmQobGlrZUJ0biwgY2FyZElkLCBjYXJkSXNMaWtlZCkge1xyXG4gIGlmICghY2FyZElzTGlrZWQpIHtcclxuICAgIGFwaVxyXG4gICAgICAubGlrZUNhcmQoY2FyZElkKVxyXG4gICAgICAudGhlbigoKSA9PiBsaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGFwaVxyXG4gICAgICAuZGlzbGlrZUNhcmQoY2FyZElkKVxyXG4gICAgICAudGhlbigoKSA9PiBsaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoKSB7XHJcbiAgZGVsZXRlQ2FyZEJ0bi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcclxuICBhcGlcclxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcclxuICAgIC5maW5hbGx5KCgpID0+IGNsb3NlTW9kYWwoZGVsZXRlQ2FyZE1vZGFsKSk7XHJcbn1cclxuXHJcbi8vIEVuc3VyZXMgdXNlciBpbmZvcm1hdGlvbiAgYW5kIGNhcmRzIGFyZSBsb2FkZWQgb24gc3RhcnR1cFxyXG5mdW5jdGlvbiBzdGFydFVwU3BvdHMoKSB7XHJcbiAgYXBpXHJcbiAgICAuc3BvdHNTdGFydFVwKClcclxuICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XHJcbiAgICAgIGNvbnN0IFtjYXJkc0RhdGEsIHVzZXJJbmZvXSA9IHJlc3VsdHM7IC8vIGRlc3RydWN0dXJpbmcgdGhlIGFycmF5XHJcblxyXG4gICAgICAvLyBOb3cgeW91IGNhbiB1c2UgZWFjaCBwaWVjZSBvZiBkYXRhOlxyXG4gICAgICAvLyBjYXJkc0RhdGEgY29udGFpbnMgdGhlIGNhcmRzIGZyb20gdGhlIHNlcnZlclxyXG4gICAgICAvLyB1c2VySW5mbyBjb250YWlucyB0aGUgdXNlciBpbmZvcm1hdGlvblxyXG5cclxuICAgICAgLy8gUHJvY2VzcyB1c2VyIGluZm8gZmlyc3RcclxuICAgICAgLy8gVXBkYXRlIHByb2ZpbGUgbmFtZSwgYWJvdXQsIGF2YXRhciwgZXRjLlxyXG4gICAgICB1c2VyUHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VySW5mby5uYW1lO1xyXG4gICAgICB1c2VyUHJvZmlsZUFib3V0LnRleHRDb250ZW50ID0gdXNlckluZm8uYWJvdXQ7XHJcbiAgICAgIHVzZXJQcm9maWxlQXZhdGFyLnNyYyA9IHVzZXJJbmZvLmF2YXRhcjtcclxuICAgICAgLy8gVGhlbiByZW5kZXIgdGhlIGNhcmRzXHJcbiAgICAgIC8vIENyZWF0ZSBhbmQgZGlzcGxheSB0aGUgY2FyZHMgb24gdGhlIHBhZ2VcclxuICAgICAgY2FyZHNEYXRhLmZvckVhY2goKGNhcmQpID0+IHJlbmRlckNhcmQoY2FyZCkpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsgLy8gSGFuZGxlIGFueSBlcnJvcnNcclxuICAgIH0pO1xyXG59XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpO1xyXG5zdGFydFVwU3BvdHMoKTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XHJcbiAgICB0aGlzLl9iYXNlVXJsID0gb3B0aW9ucy5iYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycztcclxuICB9XHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBhYm91dCxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZWRpdFVzZXJBdmF0YXIoYXZhdGFyKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcixcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGxpbmsgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGNhcmRJZCxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBjYXJkSWQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRpc2xpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgY2FyZElkLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvL3JldHVybnMgUHJvbWlzZS5hbGwoKSB0byBlbnN1cmUgYm90aCB1c2VyIGluZm8gYW5kIGNhcmRzIGFyZSByZXR1cm5lZCBieSB0aGUgYXBpIGJlZm9yZSBkaXNwbGF5aW5nIGFueXRoaW5nXHJcbiAgc3BvdHNTdGFydFVwKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiY29uZmlnIiwiZXJyb3JFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImlkIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidGV4dENvbnRlbnQiLCJhZGQiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJlbmFibGVCdXR0b24iLCJkaXNhYmxlZCIsImFwaSIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInRoaXMiLCJfYmFzZVVybCIsImJhc2VVcmwiLCJfaGVhZGVycyIsImhlYWRlcnMiLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckluZm8iLCJlZGl0VXNlckluZm8iLCJuYW1lIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRVc2VyQXZhdGFyIiwiYXZhdGFyIiwiYWRkQ2FyZCIsImxpbmsiLCJkZWxldGVDYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJkaXNsaWtlQ2FyZCIsInNwb3RzU3RhcnRVcCIsImFsbCIsImF1dGhvcml6YXRpb24iLCJ1c2VyUHJvZmlsZU5hbWUiLCJkb2N1bWVudCIsInVzZXJQcm9maWxlQWJvdXQiLCJ1c2VyUHJvZmlsZUF2YXRhciIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwibG9nb1NyYyIsImVkaXRJY29uU3JjIiwicGx1c0ljb25TcmMiLCJlZGl0UHJvZmlsZUJ0biIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0UHJvZmlsZUZvcm0iLCJmb3JtcyIsInByb2ZpbGUiLCJuZXdQb3N0QnRuIiwibmV3UG9zdE1vZGFsIiwibmV3UG9zdEZvcm0iLCJuZXdQb3N0IiwiZGVsZXRlQ2FyZE1vZGFsIiwiZGVsZXRlQ2FyZEJ0biIsImNhbmNlbERlbGV0ZUNhcmRCdG4iLCJlZGl0QXZhdGFyQnRuIiwiZWRpdEF2YXRhck1vZGFsIiwiZWRpdEF2YXRhckZvcm0iLCJhdmF0YXJMaW5rSW5wdXQiLCJwcm9maWxlSW5mb3JtYXRpb24iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVOYW1lSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImltYWdlTGlua0lucHV0IiwiY2FwdGlvbklucHV0IiwiY2FyZENvbnRhaW5lciIsIm1vZGFsSW1hZ2UiLCJtb2RhbEltYWdlUHJldmlldyIsImNhcHRpb24iLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50Iiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJoYW5kbGVFc2NhcGUiLCJldnQiLCJrZXkiLCJjbG9zZU1vZGFsIiwib3Blbk1vZGFsIiwibW9kYWwiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlbmRlckNhcmQiLCJpdGVtIiwiY2FyZEVsZW1lbnQiLCJkYXRhIiwiY2xvbmVOb2RlIiwiY2FyZFRpdGxlIiwiY2FyZEltYWdlIiwic2V0QXR0cmlidXRlIiwiY2FyZExpa2VCdG4iLCJpc0xpa2VkIiwidG9nZ2xlIiwibGlrZUJ0biIsInRhcmdldCIsIl9pZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImdldENhcmRFbGVtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJjb250YWlucyIsInZhbHVlIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdCIsImZpbmFsbHkiLCJyZXNldCIsIkFycmF5IiwiZnJvbSIsInNldEV2ZW50TGlzdGVuZXJzIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInJlc3VsdHMiLCJjYXJkc0RhdGEiLCJ1c2VySW5mbyIsImNhcmQiXSwic291cmNlUm9vdCI6IiJ9